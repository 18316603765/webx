# 配置ECS实例 {#concept_265353 .concept}

ECS（Elastic Compute Service）是阿里云提供的一种弹性可伸缩的计算服务。在Web+中创建或变更部署环境时，会创建1个或多个ECS实例用来在您选择的平台上运行应用。

## 背景信息 {#section_z1i_l8n_agy .section}

在Web+新创建的ECS实例的付费模式默认为按量付费，您可以登录[ECS控制台](https://ecs.console.aliyun.com)将Web+创建的ECS转换为预付费模式。将ECS的付费模式转为预付费后，如果释放部署环境或缩容ECS实例，Web+不会将ECS实例销毁或停机，您需自行手动释放该预付费ECS实例。

当释放部署环境或缩容ECS实例时，为保留数据，Web+默认使用停机不收费方式来释放ECS。在停机不收费模式下，vCPU、内存和公网IP将不再产生费用，云盘会被保留并收取少量费用。您可以登录[ECS控制台](https://ecs.console.aliyun.com)备份数据，然后将释放云盘。

在创建环境或者变更环境时，您都可以修改ECS配置。在进行ECS变更时，Web+会通过更新当前ECS配置或创建新ECS替换当前ECS的方式来满足配置需求。

大部分配置更改由直接更新当前ECS配置来完成。但以下4种ECS配置变更时，Web+会创建新ECS以替代当前ECS：

-   实例规格
-   密钥对
-   系统盘
-   启用公网IP

## 进入ECS实例配置页面 {#section_dxl_oik_k0n .section}

在创建新部署环境和修改正在运行的部署环境配置时，您都可以对ECS的配置进行修改。

创建应用及部署环境时

1.  登录[Web+控制台](https://webplus.console.aliyun.com)。
2.  在**概览**页**最近更新的部署环境**区域的右上角单击**新建**，根据页面提示完成**应用基本信息**和**部署环境信息**设置后进入部署环境**配置**页面。
3.  在部署环境**配置**页面选择**预设配置**模式为**自定义**。
4.  在展开的配置页面上，选择资源分类下的**主机实例**并进行配置。
5.  点击**完成创建**将新建部署环境并使ECS配置生效。

选择已有应用创建部署环境时

1.  在**概览**页**最近更新的部署环境**区域的右上角单击**查看全部**。
2.  在**应用及部署环境**页面要新建环境的应用的ID。
3.  在**部署环境管理**页面单击**创建部署环境**所在的卡片，配置部署环境信息后进入**配置**页面。
4.  在部署环境**配置**页面选择**预设配置**模式为**自定义**。
5.  在展开的配置页面上，选择资源分类下的**主机实例**并进行配置。
6.  点击**完成创建**将新建部署环境并使ECS配置生效。

更改部署环境时

1.  登录[Web+控制台](https://webplus.console.aliyun.com)。
2.  在**概览**页**最近更新的部署环境**区域的右上角单击**查看全部**。
3.  在**应用及部署环境**页面单击所选应用最左侧的 ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/163212/156048103047117_zh-CN.png)展开应用所关联的环境列表。

    **说明：** 在**概览**页会罗列4个最近更新的部署环境，如您想管理的环境在该列表中，可以直接单击环境名称进入环境管理控制台。

4.  选择并单击部署环境名称进入部署环境**概览**页面。
5.  在左侧导航栏单击**配置**进入环境配置页面。
6.  在展开的配置页面上，选择资源分类下的**主机实例**并进行配置。
7.  点击**变更配置**将更新部署环境并使ECS配置生效。

## ECS配置项说明 {#section_7yi_irm_1v3 .section}

实例规格

您最多可以选择10个实例规格。Web+会根据您选择规格的先后顺序，优先使用最先选择的规格来创建ECS实例，当其中一部分实例规格没有库存时，会使用其余的实例规格来创建ECS。在变更环境时，如果当前环境中ECS规格不在配置的规格列表之内，Web+会创建新ECS并替代当前ECS。

实例数量

对于单个部署环境，您可以设置0~100个实例。如果设置的数量比已有的实例数量少，那么Web+将会进行停止并释放实例；如果设置的数量比已有的实例数量多，那么Web+将会为您创建新的ECS。

为保留您的数据，Web+默认使用停机不收费方式来释放ECS实例。在停机不收费模式下，vCPU、内存和公网IP将不再产生费用，云盘会被保留并收取少量费用。Web+也支持释放环境来管理ECS，这样当释放环境或缩容ECS实例时，Web+会释放ECS实例。除控制台操作外您还可以通过CLI来使用释放ECS实例。

对于大规模、高可用的应用，您应该至少创建2个ECS实例，这样能在一部分ECS实例或程序发生问题时，会有多余的ECS实例仍然能提供服务。

安全组

对于每个部署环境，Web+会自动创建一个相应的安全组，该安全组默认开通80和22端口的公网访问。您可以对此安全组的规则进行修改，譬如限制公网访问22端口的IP。Web+创建此默认安全组后不会对其进行修改，因此您如果手动修改其规则，请确认您所修改的规则不会影响到正常的业务流量。

除了默认安全组之外，您也可以设置额外的安全组。当提交变更后，Web+会将已有的ECS实例加入到您所指定的安全组中；新创建的ECS实例除了加入默认安全组之外，也会加入到您所设置的安全组。

密钥对

如果您希望SSH到Web+所创建的ECS实例上，那么您可以设置密钥对。修改密钥对并提交变更，Web+会创建带有新密钥对的ECS实例来替换当前没有设置密钥对的ECS实例。

系统盘

Web+创建的ECS实例系统盘默认采取高效云盘（cloud\_efficiency），大小为100GB。您可以修改系统盘的大小，但修改范围需设置在40GB~500GB之间。修改系统盘并提交变更，Web+会创建带有新系统盘的ECS实例来替换当前的ECS实例。

启用公网IP

当您启用公网IP时，Web+会创建带有公网IP的ECS实例，否则将创建无公网访问的ECS实例；如果为对于已有的部署环境修改此属性，那么Web+将会创建新的ECS来替换当前ECS。

## 使用CLI配置ECS实例 {#section_syp_spv_hs1 .section}

CLI配置ECS需要通过Wpfile文件来进行，您可以通过wpctl dump命令来获取部署环境的Wpfile文件。您可以增加、修改或删除ECS的配置项，然后通过apply命令使其生效。

Wpfile文件中ECS配置项归类在resources.ecs.autoScaling下，配置项为：

|分类|配置项|有效值|默认值|描述|
|--|---|---|---|--|
|resources.ecs.autoScaling|instanceNum|0 ~ 100|1|所需的ECS数量。|
|instanceType|实例规格列表，YAML格式|无|实例规格列表。|
|securityGroupIds|安全组ID列表，YAML格式|无|安全组列表|
|keyPairName|密钥对名称|无|密钥对名称|
|systemDiskSize|40 ~ 500|100|系统盘大小|
|enableInternet|true / false|true|是否启用公网IP|

